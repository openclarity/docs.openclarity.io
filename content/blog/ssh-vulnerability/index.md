---
title: A new OpenSSH vulnerability
publishDate: 2023-10-10
tags: [vmclarity]
---

A new [OpenSSH vulnerability](https://thehackernews.com/2023/07/new-openssh-vulnerability-exposes-linux.html) - [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408) - has been widely publicized last month by both software vendors and news outlets.
The vulnerability exposes Linux-based systems to remote command injection, and highlights the cybersecurity threats aimed at an ever more complex and growing IT infrastructure.

Security operations specialists face a lot of day to day challenges when it comes to identifying the vulnerabilities in their systems.

In most cases it is hard to precisely determine which assets should be scanned for potential security vulnerability, whether a virtual machine hosted locally or in a public cloud provider, or a container image that runs in a pod in Kubernetes.
If the scanning procedures are not scheduled to run automatically, then the engineers have to run them manually.
Or, if the scanners are agent-based, then the daemons, processes, and libraries need to be periodically maintained on every machine.

In the first part of this post I'd like to introduce you to the architecture of VMClarity. Afterwards, I'll demonstrate how to use [VMClarity](https://github.com/openclarity/vmclarity) to detect vulnerabilities, focusing on OpenSSH [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408).

## Introducing VMClarity

[VMClarity](https://github.com/openclarity/vmclarity) is an open source tool for agentless detection and management of Virtual Machine Software Bill Of Materials (SBOM) and security threats such as vulnerabilities, exploits, malware, rootkits, misconfigurations, and leaked secrets.

![VMClarity architecture](https://raw.githubusercontent.com/openclarity/vmclarity/2571b7c1cee3ed5ec0c2eaa49b81f02c2e6b3fc1/img/vmclarity-arch-20230725.svg)

<p style="text-align: center;">The architecture of VMClarity</p>

[VMClarity](https://github.com/openclarity/vmclarity) VM scanning capabilities for major cloud providers, including AWS, Azure, and GCP. Additionally, [VMClarity](https://github.com/openclarity/vmclarity) can also be used to scan Docker assets.

No software installation is required on the asset VMs you want to scan. This is because VMClarity takes snapshots of your VMs and launches separate VMs based on these snapshots. A set of security scanners are deployed on the newly created VMs which report they findings back to the OpenClarity API.

If you want to start a scan, you can do that either via Web UI or using VMClarity [CLI](https://github.com/openclarity/vmclarity/releases). A scan can be configured to only run once, or recurringly like a cron job.

## Demo

After a short introduction to the system, letâ€™s get round to actually identifying some security issues on our VMs. In this example, we will be specifically looking for OpenSSH [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408).


### Setting up the control plane

For this demo we will use AWS, so you will need an AWS account to replicate.

[VMClarity](https://github.com/openclarity/vmclarity) has a [detailed guide](https://github.com/openclarity/vmclarity/blob/main/installation/aws/README.md) about how to install a CloudFormation stack on your AWS account. The result of the installation should be an external IPv4 address(EIP), that you can check on the Outputs tab of the CloudFormation page. Here is ours:

![CloudFormation Outputs tab](https://hackmd.io/_uploads/S1PMFom33.png)

With this public IP address you can access the web UI or submit HTTP requests to the API server from your terminal. Let's open a terminal of your choice and open an SSH connection to the control plane with the following command.

```
ssh -N -L 8080:localhost:80 -i  "<Path to the SSH key specified during install>" ubuntu@<VmClarity SSH Address copied during install>
```

Now, we have the control plane running, and we can talk to it with the forwarded SSH connection.

### Preparing a VM to be scanned

In order to find the OpenSSH security issue with [VMClarity](https://github.com/openclarity/vmclarity), there are two requirements:

- a vulnerable version of OpenSSH has to be installed on the VM
- you have to tag the VM for scanning

According to [The Hacker News article](https://thehackernews.com/2023/07/new-openssh-vulnerability-exposes-linux.html), the issue was fixed in the version [9.3p2](https://www.openssh.com/txt/release-9.3p2), so any OpenSSH version before that is fine.

![Vulnerable OpenSSH versions](https://hackmd.io/_uploads/SyRSpeZph.jpg)


After checking that the version with the vulnerability of OpenSSH is installed on the VM, I added a tag with the Key `scanconfig` and the Value `test` to it.

![asset VM](https://hackmd.io/_uploads/BkCBqURi2.png)

### Start the scan

You have two options to create and start a scan, either from the web UI or from the [CLI](https://github.com/openclarity/vmclarity/releases). For our purposes, we will use the web UI, but everything is also available via [CLI](https://github.com/openclarity/vmclarity/releases) as well.

Our VMClarity web dashboard is available at **[http://localhost:8888](http://localhost:8888)**. Navigate to **Scans** - **Conifugrations** tab.

<p style="text-align: center;">
  <img src="https://hackmd.io/_uploads/H1Z7i79h3.gif" alt="starting a scan" />
</p>

In this tab you can start a new scan by clicking the **New scan configuration** button.

Let's give the scan a proper name, and select the earlier created VM for scan with an [OData](https://github.com/CiscoM31/godata) filter.

On the next page let's select the **SBOM and Vulnerabilities** scans to run. The latter scanner finds the CVEs on your VM, and the former generates output from which the vulnerabilities can be found.

On the **Time configuration** step you can set when the scan should run, we set it to only run once for now.

On the last tab, we can set how many scans can run at a given time. The default is 2 and this is fine for us. Now let's click on the **Save button** to start the scan.

### Check the results

Once the scan has finished running, we can check the results on the **Findings** tab on the left menu.

![Results](https://hackmd.io/_uploads/HJe-xuM23.png)

On the screenshot above, you can see that we have found 3 vulnerable OpenSSH packages with an out of date version. If you click on a row in the table you can check the details of the vulnerability with more useful information and links.

![Result details](https://hackmd.io/_uploads/HJOxZufn3.png)

## Summary

[VMClarity](https://github.com/openclarity/vmclarity) simplifies running multiple scanners on different workloads and allows security operations specialists to save valuable time identifying the vulnerable assets.

If you have any questions regarding [VMClarity](https://github.com/openclarity/vmclarity) and its usage, don't hesitate to reach out on our [Slack channel](https://outshift.slack.com/).